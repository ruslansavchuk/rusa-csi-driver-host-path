version: "3.7"

services:
  controller:
    build:
      context: ./../src
      dockerfile: Dockerfile-controller
    restart: on-failure
    environment:
    - ConfigurationOptions__UnixSocket=/sockets/controller.sock
    - ConfigurationOptions__DbPath=/etc/csi-controller/data
    volumes:
       - /tmp/sockets/controller:/sockets
       - /tmp/data:/etc/csi-controller/data
    networks:
      - csi-plugin

  node:
    build:
      context: ./../src
      dockerfile: Dockerfile-node
    restart: on-failure
    environment:
    - ConfigurationOptions__UnixSocket=/sockets/node.sock
    - ConfigurationOptions__CsiDataDirectory=/tmp/csi-data
    volumes:
       - /tmp/sockets/node:/sockets
       - /tmp/csi-data-dir:/tmp/csi-data-dir
    networks:
      - csi-plugin

networks:
  csi-plugin:
    name: csi-plugin-network
